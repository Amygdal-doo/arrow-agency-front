(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{4031:(e,t,r)=>{Promise.resolve().then(r.bind(r,6552))},6552:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var s=r(5155),n=r(7923),a=r(2615),o=r(6658),i=r(2115);function l(){let{data:e,status:t}=(0,a.useSession)(),r=(0,o.useRouter)(),[,l]=(0,i.useState)(null),[,c]=(0,i.useState)(!0),[,u]=(0,i.useState)(null);return(0,i.useEffect)(()=>{if("unauthenticated"===t){r.replace("/login");return}"authenticated"===t&&(null==e?void 0:e.user)&&((async()=>{c(!0);try{let e=await n.K.get("users/me");l(e.data)}catch(e){console.error("Error fetching profile data:",e),u("Failed to fetch profile data.")}finally{c(!1)}})(),c(!1))},[t,e,r]),(0,s.jsx)("div",{className:"text-white",children:JSON.stringify(t,null,2)})}},7923:(e,t,r)=>{"use strict";r.d(t,{K:()=>g});var s=r(2615);let n=(e,t)=>{t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))},a={token:null,expiry:0},o=async()=>{let e=Date.now();if(a.token&&a.expiry>e)return a.token;let t=await (0,s.getSession)();return t&&t.user.accessToken?(a.token=t.user.accessToken,a.expiry=e+3e5,a.token):null},i=e=>{e.interceptors.request.use(async e=>{try{let t=await o();t&&n(e,t)}catch(e){console.error("Error fetching token",e)}return e},e=>Promise.reject(e))};var l=r(2651);class c{async refreshToken(){return g.responseHandler(await g.get("auth/refresh"))}}let u=new c,h=async e=>{let t=await (0,s.getSession)(),r=null==t?void 0:t.user.refreshToken;e.interceptors.response.use(e=>e,async e=>{if(console.log("2 refresh ::::"),e.response){if(401===e.response.status){if(r)return await (0,s.getSession)().then(t=>{if(t){var r,s;(null==t?void 0:null===(r=t.user)||void 0===r?void 0:r.refreshToken)&&n(e.config,null==t?void 0:null===(s=t.user)||void 0===s?void 0:s.refreshToken)}}),u.refreshToken().then(e=>e).then(t=>(n(e.config,t.accessToken),l.A.request(e.config))).catch(()=>{});console.log("8 refresh ::::")}}else{if(console.log("3 refresh ::::"),"Network Error"===e.message)throw console.log("4 refresh ::::"),console.error("Network error - server is probably down"),e;throw console.log("5 refresh ::::"),console.error("Unknown error",e),e}return e.response})},p=function(e){if(e.status>=200&&e.status<300)return e;throw e.data};class f{static getInstance(){return f.instance||(f.instance=l.A.create({baseURL:"https://whale-app-z5sve.ondigitalocean.app/api",timeout:12e4})),f.instance}}let d=e=>{i(e),h(e)};class w{responseHandler(e){let{data:t}=e;return t}async get(e,t){return p(await this._httpClient.get(e,t))}async post(e,t,r){return p(await this._httpClient.post(e,t,r))}async patch(e,t,r){return p(await this._httpClient.patch(e,t,r))}async put(e,t,r){return p(await this._httpClient.put(e,t,r))}async delete(e,t,r){let s=r||{};return t&&(s.data=t),p(await this._httpClient.delete(e,s))}constructor(){this._httpClient=f.getInstance(),d(this._httpClient)}}let g=new w}},e=>{var t=t=>e(e.s=t);e.O(0,[825,441,517,358],()=>t(4031)),_N_E=e.O()}]);